exports.handler = async (event, context) => {
  // Set the user pool autoConfirmUser flag after validating the email domain
  event.response.autoConfirmUser = false;

  // Split the email address so we can compare domains
  const address = event.request.userAttributes.email.split("@");
  try {
    // This example uses a custom attribute "custom:domain"
    if (event.request.userAttributes.hasOwnProperty("custom:domain")) {
      if (event.request.userAttributes["custom:domain"] === address[1]) {
        event.response.autoConfirmUser = true;
      }
    }
  } catch (err) {
    // Return to Amazon Cognito
    return null;
  }
};
