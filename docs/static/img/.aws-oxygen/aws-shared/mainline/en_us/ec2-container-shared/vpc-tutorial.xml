<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE section PUBLIC "-//OASIS//DTD DocBook XML V4.5//EN" "file://zonbook/docbookx.dtd"
[
    <!ENTITY % xinclude SYSTEM "file://AWSShared/common/xinclude.mod">
    %xinclude;
    <!ENTITY % phrases-shared SYSTEM "file://AWSShared/common/phrases-shared.ent"> 
    %phrases-shared;
    <!ENTITY % phrases-shared-ec2 SYSTEM "file://AWSShared/ec2-container-shared/phrases-shared-ec2.ent"> 
    %phrases-shared-ec2;
    <!ENTITY % phrases-shared-ecs-ecr SYSTEM "file://AWSShared/ec2-container-shared/phrases-shared-ecs-ecr.ent"> 
    %phrases-shared-ecs-ecr;
]>
<section id="create-public-private-vpc" role="topic">
    <info>
        <title id="create-public-private-vpc.title">Tutorial: Creating a VPC with Public and Private
            Subnets for Your <phrase revision="ecs">Clusters</phrase><phrase revision="batch"
                >Compute Environments</phrase></title>
        <titleabbrev>Tutorial: Creating a VPC</titleabbrev>
    </info>
    <para revision="ecs">Container instances in your clusters need external network access to
        communicate with the &ECS; service endpoint. However, you might have tasks and services that
        you would like to run in private subnets. Creating a VPC with both public and private
        subnets provides you the flexibility to launch tasks and services in either a public or
        private subnet. Tasks and services in the private subnets can access the internet through a
        NAT gateway. Services in both the public and private subnets can be configured to use a load
        balancer so that they can still be reached from the public internet.</para>
    <para revision="batch">Compute resources in your compute environments need external network
        access to communicate with the &ECS; service endpoint. However, you might have jobs that you
        would like to run in private subnets. Creating a VPC with both public and private subnets
        provides you the flexibility to run jobs in either a public or private subnet. Jobs in the
        private subnets can access the internet through a NAT gateway.</para>
    <para>This tutorial guides you through creating a VPC with two public subnets and two private
        subnets, which are provided with internet access through a NAT gateway.</para>
    <section id="create-EIP">
        <info>
            <title id="create-EIP.title">Step 1: Create an Elastic IP Address for Your NAT
                Gateway</title>
        </info>
        <para>A NAT gateway requires an Elastic IP address in your public subnet, but the VPC wizard
            does not create one for you. Create the Elastic IP address before running the VPC
            wizard.</para>
        <procedure>
            <title>To create an Elastic IP address</title>
            <step>&VPCConsole_switch;</step>
            <step>
                <para>In the left navigation pane, choose <guilabel>Elastic IPs</guilabel>.</para>
            </step>
            <step>
                <para>Choose <guilabel>Allocate new address</guilabel>,
                        <guilabel>Allocate</guilabel>, <guilabel>Close</guilabel>.</para>
            </step>
            <step>
                <para>Note the <guilabel>Allocation ID</guilabel> for your newly created Elastic IP
                    address; you enter this later in the VPC wizard.</para>
            </step>
        </procedure>

    </section>
    <section id="run-VPC-wizard">
        <info>
            <title id="run-VPC-wizard.title">Step 2: Run the VPC Wizard</title>
        </info>
        <para>The VPC wizard automatically creates and configures most of your VPC resources for
            you.</para>
        <procedure>
            <title>To run the VPC wizard</title>
            <step>
                <para>In the left navigation pane, choose <guilabel>VPC Dashboard</guilabel>.</para>
            </step>
            <step>
                <para>Choose <guilabel>Launch VPC Wizard</guilabel>, <guilabel>VPC with Public and Private
                        Subnets</guilabel>, <guilabel>Select</guilabel>.</para>
            </step>
            <step>
                <para>For <guilabel>VPC name</guilabel>, give your VPC a unique name.</para>
            </step>
            <step>
                <para>For <guilabel>Elastic IP Allocation ID</guilabel>, choose the ID of the
                    Elastic IP address that you created earlier.</para>
            </step>
            <step>
                <para>Choose <guilabel>Create VPC</guilabel>.</para>
            </step>
            <step>
                <para>When the wizard is finished, choose <guilabel>OK</guilabel>. Note the
                    Availability Zone in which your VPC subnets were created. Your additional
                    subnets should be created in a different Availability Zone.</para>
                <para>Non-default subnets, such as those created by the VPC wizard, are not auto-assigned public IPv4
                    addresses. Instances launched in the public subnet must be assigned a public IPv4 address to
                    communicate with the &ECS; service endpoint.</para>
            </step>
        </procedure>
        <procedure>
            <title>To modify your public subnet's IPv4 addressing behavior</title>
            <step>
                <para>In the left navigation pane, choose <guilabel>Subnets</guilabel>.</para>
            </step>
            <step>
                <para>Select the public subnet for your VPC. By default, the name created by the VPC wizard is
                    <guilabel>Public subnet</guilabel>.</para>
            </step>
            <step>
                <para>Choose <guilabel>Actions</guilabel>, <guilabel>Modify auto-assign IP settings</guilabel>.</para>
            </step>
            <step>
                <para>Select the <guilabel>Enable auto-assign public IPv4 address</guilabel> check box, and then choose
                    <emphasis role="bold">Save</emphasis>.</para>
            </step>
        </procedure>
    </section>
    <section id="create-add-subnets">
        <info>
            <title id="create-add-subnets.title">Step 3: Create Additional Subnets</title>
        </info>
        <para>The wizard creates a VPC with a single public and a single private subnet in a single
            Availability Zone. For greater availability, you should create at least one more of each
            subnet type in a different Availability Zone so that your VPC has both public and
            private subnets across two Availability Zones.</para>
        <procedure>
            <title>To create an additional private subnet</title>
            <step>
                <para>In the left navigation pane, choose <guilabel>Subnets</guilabel>.</para>
            </step>
            <step>
                <para>Choose <guilabel>Create Subnet</guilabel>.</para>
            </step>
            <step>
                <para>For <guilabel>Name tag</guilabel>, enter a name for your subnet, such as
                        <guilabel>Private subnet</guilabel>.</para>
            </step>
            <step>
                <para>For <guilabel>VPC</guilabel>, choose the VPC that you created earlier.</para>
            </step>
            <step>
                <para>For <guilabel>Availability Zone</guilabel>, choose a different Availability
                    Zone than your original subnets in the VPC.</para>
            </step>
            <step>
                <para>For <guilabel>IPv4 CIDR block</guilabel>, enter a valid CIDR block. For
                    example, the wizard creates CIDR blocks in 10.0.0.0/24 and 10.0.1.0/24 by
                    default. You could use <guilabel>10.0.3.0/24</guilabel> for your second private
                    subnet.</para>
            </step>
            <step>
                <para>Choose <guilabel>Yes, Create</guilabel>.</para>
            </step>
        </procedure>
        <procedure>
            <title>To create an additional public subnet</title>
            <step>
                <para>In the left navigation pane, choose <guilabel>Subnets</guilabel> and then
                        <guilabel>Create Subnet</guilabel>.</para>
            </step>
            <step>
                <para>For <guilabel>Name tag</guilabel>, enter a name for your subnet, such as
                        <guilabel>Public subnet</guilabel>.</para>
            </step>
            <step>
                <para>For <guilabel>VPC</guilabel>, choose the VPC that you created earlier.</para>
            </step>
            <step>
                <para>For <guilabel>Availability Zone</guilabel>, choose the same Availability Zone
                    as the additional private subnet that you created in the previous
                    procedure.</para>
            </step>
            <step>
                <para>For <guilabel>IPv4 CIDR block</guilabel>, enter a valid CIDR block. For
                    example, the wizard creates CIDR blocks in 10.0.0.0/24 and 10.0.1.0/24 by
                    default. You could use <guilabel>10.0.2.0/24</guilabel> for your second public
                    subnet.</para>
            </step>
            <step>
                <para>Choose <guilabel>Yes, Create</guilabel>.</para>
            </step>
            <step>
                <para>Select the public subnet that you just created and choose <guilabel>Route
                        Table</guilabel>, <guilabel>Edit</guilabel>.</para>
            </step>
            <step>
                <para>By default, the main route table is selected. Choose the other available
                    route table so that the <guilabel>0.0.0.0/0</guilabel> destination is routed to
                    the internet gateway
                        (<guilabel>igw-<replaceable>xxxxxxxx</replaceable></guilabel>) and choose
                        <guilabel>Save</guilabel>.</para>
            </step>
            <step>
                <para>With your second public subnet still selected, choose <guilabel>Subnet
                        Actions</guilabel>, <guilabel>Modify auto-assign IP
                    settings</guilabel>.</para>
            </step>
            <step>
                <para>Select <guilabel>Enable auto-assign public IPv4 address</guilabel> and choose
                        <guilabel>Save</guilabel>, <guilabel>Close</guilabel>.</para>
            </step>
        </procedure>
    </section>
    <section id="vpc-next-steps">
        <info>
            <title id="vpc-next-steps.title">Next Steps</title>
        </info>
        <para>After you have created your VPC, you should consider the following next steps:</para>
        <itemizedlist>
            <listitem>
                <para>Create security groups for your public and private resources if they require
                    inbound network access. For more information, see <ulink
                        url="&url-vpc-user;VPC_SecurityGroups.html#WorkingWithSecurityGroups"
                        >Working with Security Groups</ulink> in the
                        <emphasis>&guide-vpc-user;</emphasis>.</para>
            </listitem>
            <listitem revision="ecs">
                <para>Create &ECS; clusters in your private or public subnets. For more information,
                    see <xref linkend="create_cluster" endterm="create_cluster.title"/>. If you use
                    the cluster creation wizard in the &ECS; console, you can specify the VPC that
                    you just created and the public or private subnets in which to launch your
                    instances, depending on your use case.</para>
                <itemizedlist>
                    <listitem>
                        <para>To make your containers directly accessible from the internet, launch
                            instances into your <emphasis>public</emphasis> subnets. Be sure to
                            configure your container instance security groups appropriately.</para>
                    </listitem>
                    <listitem>
                        <para>To avoid making containers directly accessible from the internet,
                            launch instances into your <emphasis>private</emphasis> subnets.</para>
                    </listitem>
                </itemizedlist>
            </listitem>
            <listitem revision="ecs">
                <para>Create a load balancer in your public subnets that can route traffic to
                    services in your public or private subnets. For more information, see <xref
                        linkend="service-load-balancing" endterm="service-load-balancing.title"
                    />.</para>
            </listitem>
            <listitem revision="batch">
                <para>Create an &BATCH; managed compute environment that launches compute resources
                    into your new VPC. For more information, see <xref
                        linkend="create-compute-environment"
                        endterm="create-compute-environment.title"/>. If you use the compute
                    environment creation wizard in the &BATCH; console, you can specify the VPC that
                    you just created and the public or private subnets into which to launch your
                    instances, depending on your use case.</para>
            </listitem>
            <listitem revision="batch">
                <para>Create an &BATCH; job queue that is mapped to your new compute environment.
                    For more information, see <xref linkend="create-job-queue"
                        endterm="create-job-queue.title"/>.</para>
            </listitem>
            <listitem revision="batch">
                <para>Create a job definition to run your jobs with. For more information, see <xref
                        linkend="create-job-definition" endterm="create-job-definition.title"
                    />.</para>
            </listitem>
            <listitem revision="batch">
                <para>Submit a job with your job definition to your new job queue. This job will
                    land in the compute environment you created with your new VPC and subnets. For
                    more information, see <xref linkend="submit_job" endterm="submit_job.title"
                    />.</para>
            </listitem>
        </itemizedlist>
    </section>
</section>
