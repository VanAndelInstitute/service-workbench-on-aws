<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE chapter PUBLIC "-//OASIS//DTD DocBook XML V4.5//EN" "file://zonbook/docbookx.dtd"
 [



  <!ENTITY % _devtools-common-entities SYSTEM "../entities/_devtools-common.ent">    %_devtools-common-entities;
  <!ENTITY % xinclude SYSTEM "file://AWSShared/common/xinclude.mod">
  %xinclude;
  <!ENTITY % phrases-shared SYSTEM "file://AWSShared/common/phrases-shared.ent">
  %phrases-shared;
 ]>

 <section role="topic" id="notification-rule-create">
  <info><title id="notification-rule-create.title">Create a notification rule</title>
   <abstract>
    <para>Learn how to create a notification rule for &ACClong;.</para></abstract>
  </info>
  <para>You can use notification rules to notify users of important changes, such as when a pull
  request is created in a repository. Notification rules specify both the events and the &SNS; topic
  that is used to send notifications. For more information, see <ulink
   url="&url-acn-ug;welcome.html">What are notifications?</ulink></para>
  
  <para>You can use the console or the &CLI; to create notification rules for &ACClong;. </para>
  
  <procedure id="notification-rule-create-console">
   <info><title id="notification-rule-create-console.title">To create a notification rule (console)</title></info>
   <step>&CodeCommitConsole_DirectURL;</step>
   <step>
    <para>Choose <guilabel>Repositories</guilabel>, and then choose a repository where you want to
    add notification rules.</para>
   </step>
   <step>
    <para>On the repository page, choose <guilabel>Notify</guilabel>, and then choose
     <guilabel>Create notification rule</guilabel>. You can also go to the
     <guilabel>Settings</guilabel> page for the repository and choose <guilabel>Create notification
     rule</guilabel>.</para>
   </step>
   <step>
    <para>In <guilabel>Notification name</guilabel>, enter a name for the rule.</para>
   </step>
   <step>
   <para>In <guilabel>Detail type</guilabel>, choose <guilabel>Basic</guilabel> if you want only the
    information provided to &EVlong; included in the notification. Choose <guilabel>Full</guilabel>
    if you want to include information provided to &EVlong; and information that might be supplied
    by the &ACC; or the notification manager.</para>
   <para>For more information, see <ulink url="&url-acn-ug;security.html#security-notifications"
     >Understanding Notification Contents and Security</ulink>.</para>
  </step>
   <step>
    <para> In <guilabel>Events that trigger notifications</guilabel>, select the events for
     which you want to send notifications. </para>
    

   </step>
   <step>
    <para>In <guilabel>Targets</guilabel>, do one of the following:</para>
    <itemizedlist>
     <listitem>
      <para>If you have already configured a resource to use with notifications,
       in <guilabel>Choose target type</guilabel>, choose either
       <guilabel>&CHAT; (Slack)</guilabel> or <guilabel>SNS
        topic</guilabel>. In <guilabel>Choose target</guilabel>, choose the
       name of the client (for a Slack client configured in &CHAT;) or the
       Amazon Resource Name (ARN) of the &SNS; topic (for &SNS; topics already
       configured with the policy required for notifications).</para>
     </listitem>
     <listitem>
      <para>If you have not configured a resource to use with notifications,
       choose <guilabel>Create target</guilabel>, and then choose <guilabel>SNS
        topic</guilabel>. Provide a name for the topic after
       <guilabel>codestar-notifications-</guilabel>, and then choose
       <guilabel>Create</guilabel>.</para>
     </listitem>
    </itemizedlist>
    <note>
     <itemizedlist>
      <listitem>
       <para>If you create the &SNS; topic as part of creating the notification
        rule, the policy that allows the notifications feature to publish
        events to the topic is applied for you. Using a topic created for
        notification rules helps ensure that you subscribe only those users
        that you want to receive notifications about this resource.</para>
      </listitem>
      <listitem>
       <para>You cannot create an &CHAT; client as part of creating a
        notification rule. If you choose &CHAT; (Slack), you will see a
        button directing you to configure a client in &CHAT;. Choosing that
        option opens the &CHAT; console. For more information, see <ulink type="documentation" url="codestar-notifications/latest/userguide/notifications-chatbot.html">
        Configure Integrations Between Notifications and &CHAT;</ulink>.</para>
      </listitem>
      <listitem>
       <para>If you want to use an existing &SNS; topic as a target, you must
        add the required policy for &ACN; in addition to any other policies
        that might exist for that topic. For more information, see <ulink type="documentation" url="codestar-notifications/latest/userguide/set-up-sns.html">Configure Amazon SNS Topics for Notifications </ulink> and 
        <ulink type="documentation" url="codestar-notifications/latest/userguide/security.html#security-notifications">Understanding Notification Contents and Security</ulink>. </para>
      </listitem>
     </itemizedlist>
     <para/>
    </note>
   </step>

  <step>
   <para>To finish creating the rule, choose <guilabel>Submit</guilabel>.</para>
  </step>
  <step>
   <para>You must subscribe users to the &SNS; topic for the rule before they can receive
    notifications. For more information, see <ulink url="&url-acn-ug;subscribe-users-sns.html"
     >Subscribe Users to &SNS; Topics That Are Targets</ulink>. You can also set up integration
    between notifications and &CHAT; to send notifications to &CHM; chatrooms or Slack channels. For
    more information, see <ulink url="&url-acn-ug;notifications-chatbot.html">Configure Integration
     Between Notifications and &CHAT;</ulink>.</para>
  </step>

  </procedure>
  <procedure id="notification-rule-create-cli">
   <info><title id="notification-rule-create-cli.title">To create a notification rule (&CLI;)</title></info>
   <step>
    <para>At a terminal or command prompt, run the <command>create-notification rule</command>
    command to generate the JSON skeleton:</para>
    <programlisting>aws codestar-notifications create-notification-rule --generate-cli-skeleton > <replaceable>rule.json</replaceable></programlisting>
    <para>You can name the file anything you want. In this example, the file is named
     <replaceable>rule.json</replaceable>.</para>
   </step>
   <step>
   <para>Open the JSON file in a plain-text editor and edit it to include the resource, event types,
    and &SNS; target you want for the rule. The following example shows a notification rule named
     <userinput>MyNotificationRule</userinput> for a repository named
     <replaceable>MyDemoRepo</replaceable> in an &AWS; acccount with the ID
     <replaceable>&ExampleAWSAccountNo3;</replaceable>. Notifications with the full detail type are
    sent to an &SNS; topic named <replaceable>MyNotificationTopic</replaceable> when branches and
    tags are created:</para>
   <programlisting>{
    "Name": "<replaceable>MyNotificationRule</replaceable>",
    "EventTypeIds": [
        "codecommit-repository-branches-and-tags-created"
    ],
    "Resource": "arn:aws:codecommit:<replaceable>us-east-1</replaceable>:<replaceable>&ExampleAWSAccountNo3;</replaceable>:<replaceable>MyDemoRepo</replaceable>",
    "Targets": [
        {
            "TargetType": "SNS",
            "TargetAddress": "arn:aws:sns:<replaceable>us-east-1</replaceable>:<replaceable>&ExampleAWSAccountNo3;</replaceable>:<replaceable>MyNotificationTopic</replaceable>"
        }
    ],
    "Status": "ENABLED",
    "DetailType": "FULL"
}</programlisting>
   <para>Save the file.</para>
  </step>
   <step>
    <para>Using the file you just edited, at the terminal or command line, run the
     <command>create-notification-rule</command> command again to create the notification
    rule:</para>
    <programlisting>aws codestar-notifications create-notification-rule --cli-input-json  file://<replaceable>rule.json</replaceable></programlisting>
   </step>
   <step>
    <para>If successful, the command returns the ARN of the notification rule, similar to the
    following:</para>
    <programlisting>{
    "Arn": "arn:aws:codestar-notifications:<replaceable>us-east-1</replaceable>:<replaceable>&ExampleAWSAccountNo3;</replaceable>:notificationrule/dc82df7a-EXAMPLE"
}</programlisting>
   </step>
  </procedure>
 </section>
